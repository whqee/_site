<!DOCTYPE html><html lang="en" > <!-- The Head v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Linux LED驱动--寄存器版 | whqee's Blog</title><meta name="generator" content="Jekyll v4.0.0" /><meta property="og:title" content="Linux LED驱动–寄存器版" /><meta name="author" content="whqee" /><meta property="og:locale" content="en_US" /><meta name="description" content="Linux LED驱动" /><meta property="og:description" content="Linux LED驱动" /><link rel="canonical" href="http://localhost:4000/posts/ldd-ledv1/" /><meta property="og:url" content="http://localhost:4000/posts/ldd-ledv1/" /><meta property="og:site_name" content="whqee’s Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2019-07-11T14:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Linux LED驱动–寄存器版" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@whqee" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@type":"BlogPosting","url":"http://localhost:4000/posts/ldd-ledv1/","headline":"Linux LED驱动–寄存器版","dateModified":"2020-04-09T00:51:24+08:00","datePublished":"2019-07-11T14:00:00+08:00","author":{"@type":"Person","name":"whqee"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/posts/ldd-ledv1/"},"description":"Linux LED驱动","@context":"https://schema.org"}</script> <!-- The Favicons for Web, Android, Microsoft, and iOS (iPhone and iPad) Apps Generated by: https://www.favicon-generator.org/ v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT license --><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/favicon.ico"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon.ico"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon.ico"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/favicon.ico"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin><link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/main.css"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"><link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin> <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script> <script> window.jQuery || document.write('<script src="/assets/lib/jquery-3.4.1.min.js"><\/script>'); </script> <script src="https://cdn.jsdelivr.net/npm/popper.js@1.15.0/dist/umd/popper.min.js" integrity="sha256-fTuUgtT7O2rqoImwjrhDgbXTKUwyxxujIMRIK7TbuNU=" crossorigin="anonymous" async></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha256-5+02zu5UULQkO7w1GIr6vftCgMfFdZcAHeDtFnKZsBs=" crossorigin="anonymous" async></script> <script src="/assets/js/dist/commons.js" async></script> <script src="/assets/js/dist/timeago.min.js" async></script><link rel="preload" as="style" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/syntax.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/syntax.css"><link rel="preload" as="style" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css"><link rel="preload" as="script" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js"><link rel="stylesheet" href="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.css" /> <script src="/assets/lib/bootstrap-toc-1.0.1/bootstrap-toc.min.js" async></script> <script src="/assets/js/dist/toc.min.js" async></script> <script src="/assets/js/dist/tooltip-loader.min.js" async></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"> <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="/assets/img/sample/whqee.jpg" alt="avatar"> </a></div><div class="profile-text mt-3"><div id="site-title"> <a href="/">whqee's Blog</a></div><div id="site-subtitle" class="font-italic">keep curiosity</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-3 mr-3 unloaded"></i> <span>主页</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-3 mr-3 unloaded"></i> <span>类别</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-3 mr-3 unloaded"></i> <span>标签</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-3 mr-3 unloaded"></i> <span>归档</span> </a></li><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-3 mr-3 unloaded"></i> <span>关于</span> </a></li></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <!-- Switch the mode between dark and light. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --> <i class="mode-toggle fas fa-sun" light-mode-invisible></i> <i class="mode-toggle fas fa-moon" dark-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isDarkPrefer) { this.setDark(); } } else { if (this.isDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isDarkPrefer) { self.setDark(); } } else { if (self.isDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isDarkPrefer() { return this.sysDarkPrefers.matches; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if ((this.mode == null && this.isDarkPrefer) || this.mode == ModeToggle.DARK_MODE) { this.setLight(); } else { /* light mode or default-light */ this.setDark(); } } } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/whqee" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a href="http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=P0hXTlpaf05OEVxQUg"> <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" target="_blank"> <i class="fas fa-rss"></i> </a></div></div><div id="main-wrapper"> <!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Linux LED驱动--寄存器版</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main"> <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 --><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Linux LED驱动--寄存器版</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="timeago" data-toggle="tooltip" data-placement="bottom" title="Thu, Jul 11, 2019, 2:00 PM +0800"> Jul 11, 2019 <i class="unloaded">2019-07-11T14:00:00+08:00</i> </span> on <a href='/categories/%E8%BD%AF%E3%80%81%E7%A1%AC%E4%BB%B6%E7%BC%96%E7%A8%8B/'>软、硬件编程</a>, <a href='/categories/linux%E9%A9%B1%E5%8A%A8/'>Linux驱动</a></div></div><div class="post-content"><p>今天啥都不想做，想想那就来记录一下吧，话说有九个月没写了……</p><p>从STM32F429换到了MYS-6ULX-IOT（imx.6ull, ARM Cortex A7），中文英文的书都看了好几本，写了一些驱动，突然想写点教程，那么，先从点灯开始写吧……</p><blockquote><p><strong>在这之前</strong>，我已经看了《Linux Device Drivers Development Develop customized drivers for embedded Linux》七章有多了，然后实践是跟着这本 《Linux Driver Development for Embedded Processors Second Edition》，对我自己来说，如果忘了，拿出书和练习写的代码看一下就ok了，今天闲着没事写一篇，毕竟承诺了要把这板子（老师给我报销了200块..）交给光电协会，写几篇教程帖子给师弟师妹也好……<br /></p></blockquote><blockquote><p><strong>觉得不错的书</strong>：（可以自己买或找，也可以问我要电子版，这些是有版权的书，就不提供下载啦～）<br /> <a href="">《Linux Device Drivers Development Develop customized drivers for embedded Linux》</a>:……作者说为了节省排版，不知道他当时想的什么玩意……反向思考他可能觉得这样读者看的更细吧，于是压缩了代码……不过内容可以的。 <br /> <a href="">《Linux Driver Development for Embedded Processors Second Edition》</a>：真香！我打印了出来抱着看！<br /> <a href="">《Mastering Embedded Linux Programming, 2e》</a>：书如其名。优、缺点都是很全，也是非常好的书。<br /></p></blockquote><p>直入正题。</p><p>原理图：<a href="/assets/others/MYS-6ULX-IOT.pdf">MYS-6ULX-IOT.pdf</a><br /> datasheet：<a href="/assets/others/IMX6ULLRM.pdf">IMX6ULLRM.pdf</a><br /></p><p>打开原理图，找到我们的两个LED，它们分别接到了SNVS_TAMPER1/2： <img class="lozad" src= /assets/img/commons/loading.png data-src="/assets/img/MYS-6ULX-IOT/iot-led.jpg" alt="iot-leds" /><br /> 可以看到，输出低电平点亮，我们需要把这两个引脚设为推挽输出、上拉模式即pull-up output，以确保能够正常输出高电平。</p><p>接下来，就是配置GPIO了，首先找到引脚复用控制器寄存器，把这两引脚配置成GPIO模式，这里的是SNVS。 找到imx6ull-pinfunc-snvs.h</p><div class="highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>#ifndef __DTS_IMX6ULL_PINFUNC_SNVS_H
#define __DTS_IMX6ULL_PINFUNC_SNVS_H
/*
* The pin function ID is a tuple of
* &lt;mux_reg conf_reg input_reg mux_mode input_val&gt;
*/
#define MX6ULL_PAD_BOOT_MODE0__GPIO5_IO10                  0x0000 0x0044 0x0000 0x5 0x0
#define MX6ULL_PAD_BOOT_MODE1__GPIO5_IO11                  0x0004 0x0048 0x0000 0x5 0x0
#define MX6ULL_PAD_SNVS_TAMPER0__GPIO5_IO00                0x0008 0x004C 0x0000 0x5 0x0
#define MX6ULL_PAD_SNVS_TAMPER1__GPIO5_IO01                0x000C 0x0050 0x0000 0x5 0x0
...
</pre></table></code></div></div><p>右边的数字意义如注释，从左到右分别为</p><ul><li>IOMUX register offset</li><li>Pad configuration register offset</li><li>Select input daisy chain register offset</li><li>IOMUX configuration setting</li><li>Select input daisy chain setting <br /></li></ul><p>这里的offset(偏移量)是相对IOMUXC_SNVS的首地址而言的，在datasheet里可以看到它的map：<br /> <img class="lozad" src= /assets/img/commons/loading.png data-src="/assets/img/MYS-6ULX-IOT/Screenshot_2019-07-11_18-25-54.png" alt="snvs" /><br /> 前两个offset请看datasheet；<br /> 第三个一般为0；<br /> 第四个0x11配置成GPIO模式，详见数据手册；<br /> 第五个跟第三个一样0，现在不需要关注。<br /></p><p>看了datasheet会发现，还有个PAD_CTL寄存器没设置，这个寄存器是用来配置GPIO的:</p><p>arch/arm/boot/dts/里找到mys-imx6ull-14x14-evk.dts的&amp;iomuxc_snvs {},在里面的imx6ul-evk {}里加上如下：</p><div class="highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>...
pinctrl_gpio_leds: ledgrp {
        fsl,pins = &lt;
            MX6ULL_PAD_SNVS_TAMPER1__GPIO5_IO01 0x1b0b0
            MX6ULL_PAD_SNVS_TAMPER2__GPIO5_IO02 0x1b0b0
        &gt;;
    };
...
</pre></table></code></div></div><p>后面的数值便是PAD_CTL寄存器的设置值，0x1b0b0代表了100K上拉等的设置，具体见<strong>数据手册</strong>。(如果要把该dts推送到linux，需要到 Documentation/devicetree/bindings/pinctrl 里写好文档)</p><p>然后，在mys-imx6ull-14x14-evk.dts加上:</p><div class="highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>/ {
    ...
    led0 {
        compatible = "leds";
        label = "led0";
        pinctrl-names = "default";
        pinctrl-0 = &lt;&amp;pinctrl_gpio_leds&gt;;
    };

    led1 {
        compatible = "leds";
        label = "led1";
    };
    ...
</pre></table></code></div></div><p>后面就是写程序了： 这是个platform device driver，不详述了，自己看书 这个第一版的led驱动是独立的，不用已有的子系统，把它归到misc去，思路：</p><ul><li>弄好misc驱动程序框架，整理思路填充程序，哪里注册驱动，哪里注销驱动回收资源，预定义各数据块，需要再加；</li><li>前面的寄存器pinctrl子系统会设置，剩下的就是设置GPIO寄存器，只需要设置DATA &amp; GPIO direction两个寄存器了。所以剩下就是查datasheet找到地址，填充程序获取寄存器的virtual address，获取了总不能人工记这地址，当然把它挂到对应的led_dev,随led_dev数据块一起存在/被回收；</li><li>剩下就是向寄存器写数据了</li></ul><p>贴上程序<a href="/assets/others/led_v1_misc.c">led_v1_misc.c</a>:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
</pre><td class="rouge-code"><pre>
<span class="cp">#include &lt;linux/module.h&gt;
#include &lt;linux/fs.h&gt; </span><span class="cm">/* struct file_operations */</span><span class="cp">
#include &lt;linux/platform_device.h&gt; </span><span class="cm">/* platform_driver_register(), platform_set_drvdata() */</span><span class="cp">
#include &lt;linux/io.h&gt;         </span><span class="cm">/* devm_ioremap(), iowrite32() */</span><span class="cp">
#include &lt;linux/of.h&gt;         </span><span class="cm">/* of_property_read_string() */</span><span class="cp">
#include &lt;linux/uaccess.h&gt;    </span><span class="cm">/* copy_from_user(), copy_to_user() */</span><span class="cp">
#include &lt;linux/miscdevice.h&gt; </span><span class="cm">/* misc_register() */</span><span class="cp">
</span>
<span class="c1">// private led device structure</span>
<span class="k">struct</span> <span class="n">led_dev</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">miscdevice</span> <span class="n">led_misc_device</span><span class="p">;</span>
    <span class="n">u32</span> <span class="n">led_mask</span><span class="p">;</span>
    <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">led_name</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">led_value</span><span class="p">[</span><span class="mi">8</span><span class="p">];</span>
<span class="p">};</span>

<span class="cp">#define GPDR 0x020AC000    </span><span class="cm">/* GPIO5 DATA register: DR */</span><span class="cp">
#define GPDIR 0x020AC004    </span><span class="cm">/* GPIO5 GPIO direction register: GDIR */</span><span class="cp">
#define LED0_MASK 1 &lt;&lt; 1    </span><span class="cm">/* MASK DATA bit, GPIO_LOW to light leds */</span><span class="cp">
#define LED1_MASK 1 &lt;&lt; 2
#define ALL_MASK (1 &lt;&lt; 1 | 1 &lt;&lt; 2)
</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">GPDR_V</span><span class="p">;</span>    <span class="cm">/* get virtual address */</span>
<span class="k">static</span> <span class="kt">void</span> <span class="n">__iomem</span> <span class="o">*</span><span class="n">GPDIR_V</span><span class="p">;</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">led_write</span><span class="p">(</span><span class="k">struct</span> <span class="n">file</span> <span class="o">*</span><span class="n">file</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">__user</span> <span class="o">*</span><span class="n">buff</span><span class="p">,</span>
                                    <span class="kt">size_t</span> <span class="n">count</span><span class="p">,</span> <span class="n">loff_t</span> <span class="o">*</span><span class="n">ppos</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">u32</span> <span class="n">read</span><span class="p">,</span> <span class="n">write</span><span class="p">;</span>
    <span class="k">struct</span> <span class="n">led_dev</span> <span class="o">*</span><span class="n">led</span><span class="p">;</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"Entering led_write()...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="cm">/* The private_data is led_misc_device structure in the private led_dev structure. */</span>
    <span class="n">led</span> <span class="o">=</span> <span class="n">container_of</span><span class="p">(</span><span class="n">file</span><span class="o">-&gt;</span><span class="n">private_data</span><span class="p">,</span> <span class="k">struct</span> <span class="n">led_dev</span><span class="p">,</span> <span class="n">led_misc_device</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="n">copy_from_user</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_value</span><span class="p">,</span> <span class="n">buff</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">pr_info</span><span class="p">(</span><span class="s">"Bad copied value!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">EFAULT</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_value</span><span class="p">[</span><span class="n">count</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="sc">'\0'</span><span class="p">;</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"buff from user space: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_value</span><span class="p">);</span>
    
    <span class="n">read</span> <span class="o">=</span> <span class="n">ioread32</span><span class="p">(</span><span class="n">GPDR_V</span><span class="p">);</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_value</span><span class="p">,</span><span class="s">"1"</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_value</span><span class="p">,</span> <span class="s">"on"</span><span class="p">))</span>
        <span class="n">iowrite32</span><span class="p">(</span><span class="n">read</span> <span class="o">&amp;</span> <span class="o">~</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_mask</span><span class="p">),</span> <span class="n">GPDR_V</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_value</span><span class="p">,</span> <span class="s">"0"</span><span class="p">)</span> <span class="o">||</span> <span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_value</span><span class="p">,</span> <span class="s">"off"</span><span class="p">))</span>
        <span class="n">iowrite32</span><span class="p">(</span><span class="n">read</span> <span class="o">|</span> <span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_mask</span><span class="p">),</span> <span class="n">GPDR_V</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">pr_info</span><span class="p">(</span><span class="s">"Bad value!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"leaving led_write()...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">count</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">file_operations</span> <span class="n">led_fops</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
    <span class="p">.</span><span class="n">write</span> <span class="o">=</span> <span class="n">led_write</span><span class="p">,</span>
<span class="p">};</span>

<span class="k">static</span> <span class="kt">int</span> <span class="nf">led_probe</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"led_probe entered.</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>

    <span class="k">struct</span> <span class="n">led_dev</span> <span class="o">*</span><span class="n">led</span><span class="p">;</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"%s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">pdev</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
    <span class="n">GPDR_V</span> <span class="o">=</span> <span class="n">devm_ioremap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPDR</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">));</span>
    <span class="n">GPDIR_V</span> <span class="o">=</span> <span class="n">devm_ioremap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="n">GPDIR</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">u32</span><span class="p">));</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"0x%08lx</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">GPDR_V</span><span class="p">);</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"0x%08lx</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">GPDIR_V</span><span class="p">);</span>

    <span class="n">iowrite32</span><span class="p">(</span><span class="n">ALL_MASK</span><span class="p">,</span> <span class="n">GPDR_V</span><span class="p">);</span>
    <span class="n">iowrite32</span><span class="p">(</span><span class="n">ALL_MASK</span><span class="p">,</span> <span class="n">GPDIR_V</span><span class="p">);</span>

    <span class="n">led</span> <span class="o">=</span> <span class="n">devm_kzalloc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">led_dev</span><span class="p">),</span> <span class="n">GFP_KERNEL</span><span class="p">);</span>

    <span class="n">of_property_read_string</span><span class="p">(</span><span class="n">pdev</span><span class="o">-&gt;</span><span class="n">dev</span><span class="p">.</span><span class="n">of_node</span><span class="p">,</span> <span class="s">"label"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_name</span><span class="p">);</span>

    <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_misc_device</span><span class="p">.</span><span class="n">minor</span> <span class="o">=</span> <span class="n">MISC_DYNAMIC_MINOR</span><span class="p">;</span>
    <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_misc_device</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_name</span><span class="p">;</span>
    <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_misc_device</span><span class="p">.</span><span class="n">fops</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">led_fops</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_name</span><span class="p">,</span><span class="s">"led0"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_mask</span> <span class="o">=</span> <span class="n">LED0_MASK</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_name</span><span class="p">,</span> <span class="s">"led1"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">led</span><span class="o">-&gt;</span><span class="n">led_mask</span> <span class="o">=</span> <span class="n">LED1_MASK</span><span class="p">;</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">pr_info</span><span class="p">(</span><span class="s">"Bad device tree value...</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">EINVAL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">misc_register</span><span class="p">(</span><span class="o">&amp;</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_misc_device</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">err</span><span class="p">;</span>
    
    <span class="n">platform_set_drvdata</span><span class="p">(</span><span class="n">pdev</span><span class="p">,</span> <span class="n">led</span><span class="p">);</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"led_probe exit!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>


<span class="k">static</span> <span class="kt">int</span> <span class="nf">led_remove</span><span class="p">(</span><span class="k">struct</span> <span class="n">platform_device</span> <span class="o">*</span><span class="n">pdev</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">struct</span> <span class="n">led_dev</span> <span class="o">*</span><span class="n">led</span> <span class="o">=</span> <span class="n">platform_get_drvdata</span><span class="p">(</span><span class="n">pdev</span><span class="p">);</span>
    <span class="n">iowrite32</span><span class="p">(</span><span class="n">ALL_MASK</span><span class="p">,</span> <span class="n">GPDR_V</span><span class="p">);</span>
    <span class="n">misc_deregister</span><span class="p">(</span><span class="o">&amp;</span><span class="n">led</span><span class="o">-&gt;</span><span class="n">led_misc_device</span><span class="p">);</span>
    <span class="n">pr_info</span><span class="p">(</span><span class="s">"led_removed!</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">static</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">of_device_id</span> <span class="n">my_of_ids</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span> <span class="p">.</span><span class="n">compatible</span> <span class="o">=</span> <span class="s">"leds"</span> <span class="p">},</span>
    <span class="p">{},</span>
<span class="p">};</span>
<span class="n">MODULE_DEVICE_TABLE</span><span class="p">(</span><span class="n">of</span><span class="p">,</span> <span class="n">my_of_ids</span><span class="p">);</span>

<span class="k">static</span> <span class="k">struct</span> <span class="n">platform_driver</span> <span class="n">led_platform_driver</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">.</span><span class="n">probe</span> <span class="o">=</span> <span class="n">led_probe</span><span class="p">,</span>
    <span class="p">.</span><span class="n">remove</span> <span class="o">=</span> <span class="n">led_remove</span><span class="p">,</span>
    <span class="p">.</span><span class="n">driver</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">"leds"</span><span class="p">,</span>
        <span class="p">.</span><span class="n">of_match_table</span> <span class="o">=</span> <span class="n">my_of_ids</span><span class="p">,</span>
        <span class="p">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">THIS_MODULE</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="n">module_platform_driver</span><span class="p">(</span><span class="n">led_platform_driver</span><span class="p">);</span>
<span class="c1">// static int led_init(void)</span>
<span class="c1">// {</span>
<span class="c1">//     pr_info("led initing...\n");</span>
<span class="c1">//     int err = platform_driver_register(&amp;led_platform_driver);</span>
<span class="c1">//     if (err) {</span>
<span class="c1">//         pr_err("platform value returned %d\n", err);</span>
<span class="c1">//         return err;</span>
<span class="c1">//     }</span>
<span class="c1">//     pr_info("led init done!\n");</span>
<span class="c1">//     return 0;</span>
<span class="c1">// }</span>
<span class="c1">// static void led_exit(void)</span>
<span class="c1">// {</span>
<span class="c1">//     iowrite32(ALL_MASK, GPDR_V);</span>
<span class="c1">//     platform_driver_unregister(&amp;led_platform_driver);</span>
<span class="c1">//     pr_info("led driver exit! \n");</span>
<span class="c1">// }</span>
<span class="c1">// module_init(led_init);</span>
<span class="c1">// module_exit(led_exit);</span>


<span class="n">MODULE_LICENSE</span><span class="p">(</span><span class="s">"GPL"</span><span class="p">);</span>
<span class="n">MODULE_AUTHOR</span><span class="p">(</span><span class="s">"whqee &lt;whqee@foxmail.com&gt;"</span><span class="p">);</span>
<span class="n">MODULE_DESCRIPTION</span><span class="p">(</span><span class="s">"A simple miscellaneous led driver module."</span><span class="p">);</span>

</pre></table></code></div></div><p>没什么好说的，琢磨源码就行。运行结果：</p><p><img class="lozad" src= /assets/img/commons/loading.png data-src="http://localhost:4000/assets/img/MYS-6ULX-IOT/Screenshot_2019-07-11_19-22-34.png" alt="end" /><br /></p></div><div class="post-tail-wrapper text-muted"><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="top" title="Thu, Apr 9, 2020, 12:51 AM +0800"> Apr 9, 2020 <i class="unloaded">2020-04-09T00:51:24+08:00</i> </span></div><div class="pt-3"> <a href="/tags/mys-6ulx-iot/" class="post-tag no-text-decoration" >MYS-6ULX-IOT</a> <a href="/tags/linux%E9%A9%B1%E5%8A%A8/" class="post-tag no-text-decoration" >Linux驱动</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center pt-5 pb-2"><div class="license-wrapper"> <span class="license-text ml-1 mr-1"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 <i class="fab fa-creative-commons"></i> <i class="fab fa-creative-commons-by"></i> </a> </span></div><!-- Post sharing snippet v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div class="share-wrapper"> <span class="share-label ml-1 mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Linux LED驱动--寄存器版 - whqee's Blog&url=http://localhost:4000/posts/ldd-ledv1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Linux LED驱动--寄存器版 - whqee's Blog&u=http://localhost:4000/posts/ldd-ledv1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Linux LED驱动--寄存器版 - whqee's Blog&url=http://localhost:4000/posts/ldd-ledv1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="panel-wrapper" class="col-xl-3 pl-2 topbar-down"><div class="access"><div id="access-lastmod" class="post"><h3 data-toc-skip>Recent Update</h3><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/build-the-first-android-app/">编译你的第一个安卓APP（使用命令行，而不是Android Studio）</a></li><li><a href="/posts/openocd-usage-for-stm32/">openocd的使用</a></li><li><a href="/posts/beginning-stm32-Developing-with-GCC-1/">Linux下stm32开发环境搭建 -- Beginning STM32 Developing with GCC (1)</a></li><li><a href="/posts/redef-printf-gcc/">STM32 printf重定向，支持浮点</a></li><li><a href="/posts/makefile-smart-ways/">Makefile技巧记录/收录</a></li></ul></div><div id="access-tags"><h3 data-toc-skip>Trending Tags</h3><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <!-- The trending tags list v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT Licensed --> <a class="post-tag" href="/tags/stm32/">STM32</a> <a class="post-tag" href="/tags/进程和线程/">进程和线程</a> <a class="post-tag" href="/tags/安装桌面版linux/">安装桌面版Linux</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/yocto/">Yocto</a> <a class="post-tag" href="/tags/openocd/">OpenOCD</a> <a class="post-tag" href="/tags/makefile/">Makefile</a> <a class="post-tag" href="/tags/mys-6ulx-iot/">MYS 6ULX IOT</a> <a class="post-tag" href="/tags/linux驱动/">Linux驱动</a> <a class="post-tag" href="/tags/android/">Android</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><h3 data-toc-skip class="pl-3 pt-2 mb-3">Contents</h3><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="post-extend-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"> <!-- Navigation buttons at the bottom of the post. v2.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License --><div class="post-navigation d-flex justify-content-between"> <a href="/posts/armv7m/" class="btn btn-outline-primary"><p>ARMv7-M 汇编指令</p></a> <a href="/posts/process-and-thread/" class="btn btn-outline-primary"><p>进程？线程？一文读懂！（由来+概念）</p></a></div><!-- The related posts of current post. Placed in the bottom of every single post. v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung Published under the MIT License --><div id="related-posts" class="mt-4 mb-2 mb-sm-4 pb-2"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/openocd-usage-for-stm32/"><div class="card-body"> <span class="timeago small"> Sep 24, 2018 <i class="unloaded">2018-09-24T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>openocd的使用</h3><div class="text-muted small"><p>来自我的CSDN，原文： https://blog.csdn.net/baidu_36482169/article/details/81005060 一、openocd安装使用遇到的问题： sudo apt-get install 的openocd-0.10.0，玩着Nucleo STM32L496，flash erase…不行： 1 2 3 4 &amp;gt; flash erase_sec...</p></div></div></a></div><div class="card"> <a href="/posts/beginning-stm32-Developing-with-GCC-1/"><div class="card-body"> <span class="timeago small"> Oct 21, 2018 <i class="unloaded">2018-10-21T18:14:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Linux下stm32开发环境搭建 -- Beginning STM32 Developing with GCC (1)</h3><div class="text-muted small"><p>all was tested on linux mint 19 一、软件清单 gcc-arm-none-eabi-toolchain(交叉编译工具链), VSCode(用来编辑), OpenOCD(调试/下载), STM32CubeMX(使用ST的HAL/LL库) 请读者先去了解清楚下面的问题再往下阅读: 什么是编译工具链？ gcc-arm-none-eabi-toolchain与PC...</p></div></div></a></div><div class="card"> <a href="/posts/redef-printf-gcc/"><div class="card-body"> <span class="timeago small"> Mar 2, 2019 <i class="unloaded">2019-03-02T18:55:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>STM32 printf重定向，支持浮点</h3><div class="text-muted small"><p>添加如下代码： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 #include "stdio.h" #include "stdlib.h" #ifdef __GNUC__ #define PUTCHAR_PROTOTYPE int __io_putchar(int ch) #else #define PUTCHAR_PROTOTYPE in...</p></div></div></a></div></div></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const observer = lozad(); observer.observe(); </script> <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2020 <a href="https://twitter.com/username">whqee</a>. <span data-toggle="tooltip" data-placement="top" title="The blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> with theme <a href="https://github.com/cotes2020/jekyll-theme-chirpy/">Chirpy</a>.</p></div></div></footer></div><!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted">Trending Tags</h4><!-- The trending tags list v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2019 Cotes Chung MIT Licensed --> <a class="post-tag" href="/tags/stm32/">STM32</a> <a class="post-tag" href="/tags/进程和线程/">进程和线程</a> <a class="post-tag" href="/tags/安装桌面版linux/">安装桌面版Linux</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/yocto/">Yocto</a> <a class="post-tag" href="/tags/openocd/">OpenOCD</a> <a class="post-tag" href="/tags/makefile/">Makefile</a> <a class="post-tag" href="/tags/mys-6ulx-iot/">MYS 6ULX IOT</a> <a class="post-tag" href="/tags/linux驱动/">Linux驱动</a> <a class="post-tag" href="/tags/android/">Android</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <!-- Jekyll Simple Search loader v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License --> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js" integrity="sha256-qcLR00zq6pJk4je3MLgAri8Nn+ZumUlXgTKR2H/xCY0=" crossorigin="anonymous"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="http://localhost:4000{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script>
